<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<title>2026–2028 투자 실행 플랜 (모바일 최적화)</title>
<style>
  :root { 
    --brand:#0d6efd; 
    --ink:#111; 
    --muted:#6c757d; 
    --bg:#f8f9fa; 
    --card:#fff; 
    --ok:#0aa; 
    --warn:#e67e22; 
    --bad:#c0392b;
    --touch-target: 48px;
  }
  * { box-sizing: border-box; }
  body { 
    font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; 
    background: var(--bg); 
    color: var(--ink); 
    margin:0; 
    font-size: 16px;
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
  }
  
  header { 
    background: var(--brand); 
    color:#fff; 
    padding:20px 16px; 
    text-align: center;
  }
  header h1 { 
    margin:0; 
    font-size:22px; 
    font-weight: 700;
  }
  header p { 
    margin:12px 0 0; 
    font-size:14px; 
    color: #e9f2ff; 
    line-height: 1.4;
  }
  
  .tabs { 
    display:flex; 
    gap:4px; 
    padding:12px 12px 0; 
    overflow-x:auto; 
    background: var(--bg); 
    position: sticky; 
    top:0; 
    z-index: 3;
    -webkit-overflow-scrolling: touch;
  }
  .tab-btn { 
    background:#fff; 
    border:2px solid #e3e3e3; 
    border-bottom:none; 
    padding:12px 20px; 
    border-radius:12px 12px 0 0; 
    cursor:pointer; 
    font-weight:600; 
    color:#333;
    min-height: var(--touch-target);
    font-size: 16px;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .tab-btn.active { 
    background:#fff; 
    color:var(--brand); 
    border-color: var(--brand); 
    box-shadow: 0 2px 0 #fff inset; 
  }
  
  .tab { 
    display:none; 
    padding:16px; 
    background:#fff; 
    border:2px solid #e3e3e3; 
    border-top:none; 
  }
  .tab.active { display:block; }
  
  .panel { 
    display:flex; 
    flex-direction: column; 
    gap:16px; 
    margin:0 0 20px; 
  }
  
  .card { 
    background: var(--card); 
    border:1px solid #ececec; 
    border-radius:16px; 
    padding:20px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .card h3 { 
    margin:0 0 16px; 
    font-size:20px; 
    font-weight: 700;
  }
  
  label { 
    font-size:14px; 
    color:#444; 
    display:block; 
    margin-bottom:8px; 
    font-weight: 500;
  }
  
  input[type="number"], select { 
    width:100%; 
    padding:12px 16px; 
    border:2px solid #ddd; 
    border-radius:12px;
    font-size: 16px;
    min-height: var(--touch-target);
    -webkit-appearance: none;
    background: #fff;
  }
  input[type="number"]:focus, select:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
  }
  
  input[type="checkbox"] { 
    transform: scale(1.3); 
    vertical-align: middle; 
    margin-right: 8px;
  }
  
  button { 
    padding:12px 20px; 
    border-radius:12px; 
    border:2px solid #d0d7de; 
    background:#fff; 
    cursor:pointer; 
    font-weight:600;
    font-size: 16px;
    min-height: var(--touch-target);
    -webkit-tap-highlight-color: rgba(0,0,0,0.1);
  }
  button.primary { 
    background: var(--brand); 
    color:#fff; 
    border-color: var(--brand); 
  }
  button:active {
    transform: translateY(1px);
  }
  
  .grid-2 { 
    display:grid; 
    grid-template-columns: 1fr 1fr; 
    gap:12px;
    align-items: end;
  }
  
  .summary { 
    display:flex; 
    gap:8px; 
    flex-wrap: wrap; 
    margin-top:16px; 
  }
  .pill { 
    background:#f1f5ff; 
    color:#1a3d8f; 
    padding:8px 12px; 
    border-radius:20px; 
    font-size:13px; 
    border:1px solid #d7e3ff;
    flex: 1;
    min-width: 120px;
    text-align: center;
  }
  
  .muted { color: var(--muted); }
  .note { 
    font-size:13px; 
    color:#666; 
    margin-top:12px; 
    line-height: 1.4;
  }
  
  /* 모바일 친화적 월별 카드 레이아웃 */
  .month-cards {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .month-card {
    background: #fff;
    border: 1px solid #e5e5e5;
    border-radius: 12px;
    padding: 16px;
    position: relative;
  }
  
  .month-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  
  .month-name {
    font-weight: 700;
    font-size: 18px;
    color: var(--brand);
  }
  
  .strategy-text {
    cursor: pointer;
    text-decoration: underline;
    color: #0b5ed7;
    font-size: 14px;
    line-height: 1.3;
    margin: 8px 0;
    padding: 8px;
    background: #f8f9ff;
    border-radius: 8px;
    border: 1px solid #e5ecff;
  }
  
  .month-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin: 12px 0;
  }
  
  .month-inputs label {
    margin-bottom: 4px;
    font-size: 13px;
  }
  
  .month-results {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #eee;
  }
  
  .result-item {
    text-align: center;
    font-size: 12px;
  }
  
  .result-label {
    color: var(--muted);
    margin-bottom: 4px;
  }
  
  .result-value {
    font-weight: 600;
    color: var(--ink);
  }
  
  .totals-card {
    background: #f8f9fa;
    border: 2px solid var(--brand);
    margin-top: 16px;
  }
  
  .totals-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    text-align: center;
  }
  
  .total-item {
    padding: 12px 8px;
  }
  
  .total-label {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  
  .total-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--brand);
  }
  
  .button-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 16px;
  }
  
  /* Modal - 풀스크린으로 변경 */
  .modal { 
    position: fixed; 
    inset:0; 
    display:none; 
    z-index: 100; 
    background: rgba(0,0,0,.6);
  }
  .modal.show { display:flex; }
  
  .dialog { 
    width: 100%;
    height: 100%;
    background:#fff;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  .dialog header { 
    display:flex; 
    align-items:center; 
    justify-content: space-between; 
    padding:16px 20px; 
    background:#f6f9ff; 
    border-bottom:1px solid #e5ecff; 
    color:#123;
    flex-shrink: 0;
  }
  .dialog header h3 { 
    margin:0; 
    font-size:18px; 
    color:#0b3d91; 
    line-height: 1.3;
    flex: 1;
    padding-right: 12px;
  }
  
  .dialog .content { 
    padding:20px; 
    overflow-y: auto;
    flex: 1;
    -webkit-overflow-scrolling: touch;
  }
  
  .wk { 
    border:1px solid #eef1f6; 
    border-radius:12px; 
    padding:16px; 
    margin-bottom:16px; 
    background:#fbfdff; 
  }
  .wk h4 { 
    margin:0 0 12px; 
    font-size:16px; 
    color: var(--brand);
  }
  .wk ul { 
    margin:8px 0 0 20px; 
    line-height: 1.4;
  }
  .wk li {
    margin-bottom: 6px;
  }
  .kpi { 
    font-size:12px; 
    color:#295; 
    margin-top:12px; 
    padding: 8px;
    background: #e8f5e8;
    border-radius: 6px;
  }
  
  .close { 
    background:#fff; 
    border:2px solid #d0d7de; 
    border-radius:12px; 
    padding:8px 12px; 
    cursor:pointer;
    font-size: 14px;
    min-height: 40px;
    flex-shrink: 0;
  }
  
  .risk-checklist {
    margin: 16px;
  }
  
  .risk-checklist ul {
    padding-left: 20px;
  }
  
  .risk-checklist li {
    margin-bottom: 8px;
    line-height: 1.4;
  }
  
  details {
    margin: 12px 0;
  }
  
  summary {
    cursor: pointer;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 8px;
    font-weight: 600;
  }
  
  footer {
    text-align: center;
    padding: 24px 16px;
    color: var(--muted);
    font-size: 14px;
  }
  
  /* 작은 화면 최적화 */
  @media (max-width: 480px) {
    .grid-2 { 
      grid-template-columns: 1fr; 
      gap: 8px;
    }
    
    .month-inputs {
      grid-template-columns: 1fr;
      gap: 8px;
    }
    
    .month-results {
      grid-template-columns: 1fr;
      gap: 12px;
      text-align: left;
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .result-item:last-child {
      border-bottom: none;
    }
    
    .totals-grid {
      grid-template-columns: 1fr;
      gap: 8px;
    }
    
    .total-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: left;
    }
    
    .pill {
      flex: none;
      min-width: 100%;
    }
    
    .button-group {
      gap: 8px;
    }
    
    header h1 {
      font-size: 20px;
    }
    
    .dialog header h3 {
      font-size: 16px;
    }
  }
  
  /* 가로 스크롤 방지 */
  html, body {
    overflow-x: hidden;
  }
  
  /* 터치 개선 */
  button, input, select, .strategy-text {
    -webkit-tap-highlight-color: rgba(0,0,0,0.1);
  }
</style>
</head>
<body>
  <header>
    <h1>2026–2028 투자 실행 플랜</h1>
    <p>월별 <strong>전략을 클릭</strong>하면 1~4주차 세분화 전략이 열립니다. 수익률/납입/세후·복리 시뮬은 탭 내에서 즉시 계산됩니다.</p>
  </header>

  <nav class="tabs" id="tabs"></nav>
  <main id="tab-wrap"></main>

  <section class="card risk-checklist">
    <h3>리스크 관리 체크리스트</h3>
    <ul class="muted">
      <li><strong>플랫폼 편중 금지:</strong> 단일 프로토콜·발행사 25% 초과 금지.</li>
      <li><strong>현금흐름 추적:</strong> 모든 거래·리워드·수수료 월별 고정 기록.</li>
      <li><strong>버킷 배분:</strong> 저위험 40~60% / 중위험 20~40% / 고위험 0~20%.</li>
      <li><strong>세금·환율:</strong> 세후/원화 기준으로 스트레스 시나리오 포함.</li>
      <li><strong>컴파운딩 리스크:</strong> 손실도 복리화되므로 손절·이탈 규칙 명시.</li>
    </ul>
    <p class="note">※ 학습·계획용 도구이며 최종 의사결정은 사용자 책임입니다.</p>
  </section>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modaltitle">
    <div class="dialog">
      <header>
        <h3 id="modaltitle">주차별 실행전략</h3>
        <button class="close" id="closeModal">닫기</button>
      </header>
      <div class="content" id="modalcontent"></div>
    </div>
  </div>

<script>
const fmtKRW = n => (isFinite(n) ? n.toLocaleString('ko-KR') : '0');
const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

// 기본 플랜
const PLANS = {
  "2026": [
    { m:"1월",  s:"콜드월렛 세팅 + LST/Liquid Staking 최적화", r:5.0 },
    { m:"2월",  s:"RWA(미국채·부동산형) 분산 예치",            r:8.0 },
    { m:"3월",  s:"농지·중소기업 DAO 분산·검증",                r:10.0 },
    { m:"4월",  s:"디지털 노동(뉴스레터·NFT) PoC",              r:2.0 },
    { m:"5월",  s:"AI 생산 자동화(콘텐츠/봇) 도입",              r:0.0 },
    { m:"6월",  s:"DAO 평판/온체인 신원 패스포트 구축",         r:0.0 },
    { m:"7월",  s:"RWA 리밸런싱(Ondo T-Bill 등)",              r:2.5 },
    { m:"8월",  s:"AI 수익화 운영(블로그·노코드 상점)",          r:4.0 },
    { m:"9월",  s:"수익 정산 자동화(봇·스크립트)",               r:2.5 },
    { m:"10월", s:"DeFi/TradFi 성과 비교 및 베타 축소",          r:5.5 },
    { m:"11월", s:"이자 회수·현금화·세금 준비",                  r:1.5 },
    { m:"12월", s:"연말 결산·DAO 평판 정리·연간 설계",           r:1.5 },
  ],
  "2027": [
    { m:"1월",  s:"ENS/Lens/Farcaster 신원 세팅",               r:4.0 },
    { m:"2월",  s:"소셜 퀘스트(Galxe/Layer3) 성과형 운영",      r:3.0 },
    { m:"3월",  s:"NFT 발행·수집(Zora/Sound) 로드맵",           r:7.5 },
    { m:"4월",  s:"소셜·DAO 기여 확장(평판 가속)",               r:3.0 },
    { m:"5월",  s:"퀘스트 포트폴리오 최적화(ROI 우선)",          r:4.5 },
    { m:"6월",  s:"Zora/콘텐츠 업로드·온체인 저작권",            r:6.0 },
    { m:"7월",  s:"DeBank 대시보드/KPIs 정착",                   r:3.0 },
    { m:"8월",  s:"Web3 수익화 확장(협업/제휴)",                 r:4.0 },
    { m:"9월",  s:"Web3 수익화 확장(광고/스폰서)",               r:4.0 },
    { m:"10월", s:"Web3 수익화 확장(프리미엄 상품)",             r:4.0 },
    { m:"11월", s:"Web3 수익화 확장(구독 모델)",                 r:4.0 },
    { m:"12월", s:"Web3 수익화 확장(에코시스템화)",              r:4.0 },
  ],
  "2028": [
    { m:"1월",  s:"RWA 예치 + 자동화(스케줄러)",                 r:3.0 },
    { m:"2월",  s:"RWA 예치 + 자동화(리밸런싱 규칙)",            r:3.0 },
    { m:"3월",  s:"DeFi+RWA 믹스(Aave/Compound) 최적화",        r:4.5 },
    { m:"4월",  s:"기관형 대출풀(Maple/Clearpool) 샤프 개선",    r:4.0 },
    { m:"5월",  s:"CeFi vs DeFi 성과 비교/수수료 절감",           r:6.5 },
    { m:"6월",  s:"금/지수 연동 ETF·헤지 전략 탐색",              r:8.0 },
    { m:"7월",  s:"연간 중간점검·리밸런싱·리스크컷",              r:1.5 },
    { m:"8월",  s:"RWA 자동화(워크플로우·알럿)",                 r:4.0 },
    { m:"9월",  s:"RWA 자동화(복구·DR·키 관리)",                 r:4.0 },
    { m:"10월", s:"RWA 자동화(감사로그·권한 분리)",              r:4.0 },
    { m:"11월", s:"RWA 자동화(세무·환헤지 시나리오)",            r:4.0 },
    { m:"12월", s:"RWA 자동화(연말 셧다운·현금화)",              r:4.0 },
  ],
};

// 상태(시뮬 파라미터)
const STATE = {
  "2026": { seed: 30000000, compounding: "compound", taxOn: false, taxRate: 15.4 },
  "2027": { seed: 33000000, compounding: "compound", taxOn: false, taxRate: 15.4 },
  "2028": { seed: 36000000, compounding: "compound", taxOn: false, taxRate: 15.4 },
};

// 전략 키워드 → 주차별 템플릿 생성기
function weeklyTemplate(strategy) {
  const s = strategy.toLowerCase();
  const tpl = (w1,w2,w3,w4)=>[w1,w2,w3,w4];

  // 공통 KPI/리스크 템플릿 헬퍼
  const KPI = {
    base: [
      "일간 손익/누적손익 기록(스프레드시트)",
      "낮음·중간·높음 위험 버킷 비중 준수(25% 편중 금지)",
      "수수료/슬리피지 0.2%p 초과시 체결 금지",
    ],
  };

  if (s.includes("lst") || s.includes("staking")) {
    return tpl(
      {title:"1주차: 키 관리·보안·테스트", items:[
        "콜드월렛/하드월렛 세팅 및 시드 분리 보관(2중 백업)",
        "소액으로 LST 예치·언스테이킹 테스트",
        "수수료·슬리피지 확인 및 문서화",
        ...KPI.base
      ], kpi:["키 재현 테스트 2/2 성공","테스트 이체 실패율 0%"]},
      {title:"2주차: 프로토콜 선정·예치", items:[
        "프로토콜 2~3개 선택(지배적/대안)",
        "예치 분산(한곳 25% 초과 금지)",
        "리워드 클레임 주기·가스비 산정",
      ], kpi:["예치 완료율 100%","프로토콜당 비중 ≤25%"]},
      {title:"3주차: 리스팅·재예치 자동화", items:[
        "리워드 자동 클레임/재예치 봇 설정",
        "이상 징후(에이프릴·디페깅) 알림",
      ], kpi:["자동화 성공률 ≥99%","누수 가스비 월 < 0.3%p"]},
      {title:"4주차: 리스크 드릴·리밸런싱", items:[
        "언스테이킹 지연/비상 출금 리허설",
        "목표수익 미달 시 RWA로 일부 이동",
      ], kpi:["RTO(복구시간) < 24h","월 수익률 목표범위 달성"]}
    );
  }
  if (s.includes("rwa") || s.includes("t-bill") || s.includes("미국채") || s.includes("부동산")) {
    return tpl(
      {title:"1주차: 실사·KYC·수수료", items:[
        "발행사·커스터디·감사보고서 확인",
        "KYC/AML 절차, 거주자 제한 검토",
        "수수료·락업·환전비용 이비용 산출",
        ...KPI.base
      ], kpi:["이비용(TER) 산출","리스크 매트릭스 완성"]},
      {title:"2주차: 분산 배치·헤지", items:[
        "미국채/부동산형 등 2~3종 분산",
        "환율 헤지(선물·ETF) 비중 0~50%",
      ], kpi:["단일 발행사 ≤25%","헤지 비용/효과 리포트"]},
      {title:"3주차: 현금흐름 자동화", items:[
        "이자 수취 캘린더·웹훅 알림",
        "세액 추정·원화 환산 자동기록",
      ], kpi:["현금흐름 지연 0건","세무 로그 월 100%"]},
      {title:"4주차: 리밸런싱·스트레스", items:[
        "금리/환율 시나리오 스트레스 테스트",
        "목표 수익·변동성 범위 재설정",
      ], kpi:["MDD 목표 ≤5%","샤프 레이시오 개선"]}
    );
  }
  if (s.includes("dao")) {
    return tpl(
      {title:"1주차: 거버넌스 온보딩", items:[
        "디스코드/포럼/스냅샷 가입",
        "토큰 가중치/투표권 구조 파악",
      ], kpi:["필수 채널 가입 100%","투표 참여 1회"]},
      {title:"2주차: 기여 포지션 정의", items:[
        "역할(리서치/콘텐츠/개발) 확정",
        "첫 PR/제안 작성·피드백 수렴",
      ], kpi:["PR/제안 1건 이상","피드백 반영 100%"]},
      {title:"3주차: 평판 축적", items:[
        "기여물 2~3건 납품·리뷰 확보",
        "온체인 인증/평판 NFT 취득",
      ], kpi:["리뷰 2건 이상","평판 NFT 1개+"]},
      {title:"4주차: 보상·리스크 관리", items:[
        "보상 청구·회수 프로세스 점검",
        "거버넌스 리스크(포크/쿼럼) 검토",
      ], kpi:["보상 회수율 100%","리스크 보고서 1건"]}
    );
  }
  if (s.includes("ai") || s.includes("수익화") || s.includes("콘텐츠")) {
    return tpl(
      {title:"1주차: 아이디어·파이프라인 설계", items:[
        "키워드·페르소나·포맷 정의",
        "자동화 파이프라인(스크립트/봇) 설계",
      ], kpi:["초안 3개","자동화 설계서 1건"]},
      {title:"2주차: 제작·배포", items:[
        "콘텐츠 8~12개 생산",
        "블로그/소셜/마켓 동시 배포",
      ], kpi:["CTR ≥3%","게시 10건+"]},
      {title:"3주차: 수익모델 실험", items:[
        "광고/제휴/디지털 상품 A/B 테스트",
        "가격·랜딩·카트 전환율 개선",
      ], kpi:["전환율 +20%","ARPU +10%"]},
      {title:"4주차: 자동화·확장", items:[
        "스케줄러/알럿/리포트 자동화",
        "실패 케이스 라이브러리화",
      ], kpi:["자동화 실패율 <1%","주간 OPS 4h 이하"]}
    );
  }
  if (s.includes("리밸런싱") || s.includes("비교") || s.includes("점검")) {
    return tpl(
      {title:"1주차: 성과 분해", items:[
        "기여도 분석(알파/베타/수수료)",
        "승/패 요인 도출",
      ], kpi:["성과 기여표 1건","수수료 비중 산출"]},
      {title:"2주차: 규칙 정교화", items:[
        "리밸런싱 트리거(±5%p) 명문화",
        "손절/이탈 규칙 수치화",
      ], kpi:["트리거 문서화 100%","백테스트 1회"]},
      {title:"3주차: 실행", items:[
        "목표 비중으로 재배치",
        "세후·환율 고려한 최적화 체결",
      ], kpi:["체결 슬리피지 <0.2%","목표 비중 ±1%p"]},
      {title:"4주차: 회고·다음달 준비", items:[
        "실행 리뷰·교훈 기록",
        "다음달 전략/예산 확정",
      ], kpi:["리뷰 노트 1건","다음달 플랜 확정"]}
    );
  }
  if (s.includes("nft")) {
    return tpl(
      {title:"1주차: 리서치·커뮤니티", items:[
        "테마/크리에이터 선정",
        "커뮤니티 온보딩·알림셋업",
      ], kpi:["워치리스트 10개","커뮤니티 3곳 참여"]},
      {title:"2주차: 제작·민팅", items:[
        "초안→민팅(테스트넷→메인넷)",
        "수수료 최적화·권리표기",
      ], kpi:["민팅 3~5개","비용/작업시간 기록"]},
      {title:"3주차: 유통·마케팅", items:[
        "플랫폼(오픈씨/Zora) 배포",
        "크로스포스트·콜랩 제안",
      ], kpi:["세일즈 3건+","팔로워 +5%"]},
      {title:"4주차: 수익화·지속성", items:[
        "세컨더리 로열티 구조 점검",
        "재발행/시리즈 계획",
      ], kpi:["로열티 회수율 100%","다음 시리즈 초안"]}
    );
  }
  // 기본(범용)
  return tpl(
    {title:"1주차: 목표·지표 확정", items:[
      "수익률·MDD·현금비중 목표 확정",
      "데이터 기록/알림 자동화 설정",
    ], kpi:["목표표 1건","알림 100% 동작"]},
    {title:"2주차: 실행·분산", items:[
      "프로토콜/자산 분산 배치",
      "체결비용 통제",
    ], kpi:["편중 0건","슬리피지 <0.2%"]},
    {title:"3주차: 모니터링·튜닝", items:[
      "성과/KPI 주중 점검 2회",
      "실패 케이스 교정",
    ], kpi:["성공률 >95%","누수비용 최소화"]},
    {title:"4주차: 회수·정산", items:[
      "이자 회수/세후 정산",
      "다음달 계획 확정",
    ], kpi:["정산 지연 0건","다음달 준비 100%"]}
  );
}

function createTab(year){
  const tab = document.createElement('section');
  tab.className = 'tab';
  tab.id = `tab-${year}`;

  const panel = document.createElement('div');
  panel.className = 'panel';

  // 컨트롤 카드
  const ctrl = document.createElement('div');
  ctrl.className = 'card';
  ctrl.innerHTML = `
    <h3>${year}년 시뮬레이터</h3>
    <label>시작 자산(원)</label>
    <input type="number" inputmode="numeric" min="0" step="10000" id="seed-${year}" value="${STATE[year].seed}"/>
    <div class="grid-2" style="margin-top:12px;">
      <div>
        <label>수익 방식</label>
        <select id="mode-${year}">
          <option value="compound" ${STATE[year].compounding==="compound"?"selected":""}>복리 (매월 이자 재투자)</option>
          <option value="simple" ${STATE[year].compounding==="simple"?"selected":""}>단리 (원금에만 적용)</option>
        </select>
      </div>
      <div>
        <label><input type="checkbox" id="tax-${year}" ${STATE[year].taxOn?"checked":""}/> 세후 시뮬</label>
        <label>이자 과세율(%)</label>
        <input type="number" id="taxrate-${year}" value="${STATE[year].taxRate}" min="0" max="55" step="0.1"/>
      </div>
    </div>
    <div class="button-group">
      <button class="primary" id="recalc-${year}">계산하기</button>
      <button id="reset-${year}">기본값 채우기</button>
      <button id="clear-${year}">월별 입력 리셋</button>
    </div>
    <p class="note">월별 <strong>수익률(%)</strong>과 <strong>추가 납입(원)</strong>을 원하는 대로 수정해보세요. 전략 문구를 클릭하면 1~4주차 전략이 열립니다.</p>
  `;

  // 요약 카드
  const sum = document.createElement('div');
  sum.className = 'card';
  sum.innerHTML = `
    <h3>${year}년 요약</h3>
    <div class="summary">
      <span class="pill">총 추가 납입: <strong id="add-${year}">0</strong> 원</span>
      <span class="pill">총 이익: <strong id="prof-${year}">0</strong> 원</span>
      <span class="pill">연말 잔액: <strong id="end-${year}">0</strong> 원</span>
    </div>
  `;

  panel.appendChild(ctrl);
  panel.appendChild(sum);

  // 월별 카드들
  const monthsContainer = document.createElement('div');
  monthsContainer.className = 'card';
  monthsContainer.innerHTML = `
    <h3>${year}년 월별 계획</h3>
    <div class="month-cards" id="months-${year}"></div>
    <div class="totals-card card">
      <h3>총합</h3>
      <div class="totals-grid">
        <div class="total-item">
          <div class="total-label">총 납입</div>
          <div class="total-value" id="t-add-${year}">0</div>
        </div>
        <div class="total-item">
          <div class="total-label">총 이익</div>
          <div class="total-value" id="t-prof-${year}">0</div>
        </div>
        <div class="total-item">
          <div class="total-label">최종 잔액</div>
          <div class="total-value" id="t-end-${year}">0</div>
        </div>
      </div>
    </div>
  `;

  tab.appendChild(panel);
  tab.appendChild(monthsContainer);

  return tab;
}

function renderRows(year){
  const container = document.getElementById(`months-${year}`);
  container.innerHTML = "";
  const plan = PLANS[year];
  
  plan.forEach((row, idx)=>{
    const monthCard = document.createElement('div');
    monthCard.className = 'month-card';
    monthCard.innerHTML = `
      <div class="month-header">
        <div class="month-name">${row.m}</div>
      </div>
      <div class="strategy-text" data-year="${year}" data-i="${idx}" title="클릭하여 1~4주차 전략 보기">
        ${row.s}
      </div>
      <div class="month-inputs">
        <div>
          <label>수익률(%)</label>
          <input type="number" min="-50" max="50" step="0.1" value="${row.r}" data-year="${year}" data-i="${idx}" class="rate-input" />
        </div>
        <div>
          <label>추가 납입(원)</label>
          <input type="number" min="0" step="10000" value="0" data-year="${year}" data-i="${idx}" class="add-input" />
        </div>
      </div>
      <div class="month-results">
        <div class="result-item">
          <div class="result-label">시작 잔액</div>
          <div class="result-value" id="start-${year}-${idx}">0</div>
        </div>
        <div class="result-item">
          <div class="result-label">이익</div>
          <div class="result-value" id="profit-${year}-${idx}">0</div>
        </div>
        <div class="result-item">
          <div class="result-label">종료 잔액</div>
          <div class="result-value" id="endb-${year}-${idx}">0</div>
        </div>
      </div>
    `;
    container.appendChild(monthCard);
  });

  // 전략 셀 클릭 → 모달
  container.querySelectorAll('.strategy-text').forEach(div=>{
    div.addEventListener('click', (e)=>{
      const y = e.currentTarget.dataset.year;
      const i = Number(e.currentTarget.dataset.i);
      const row = PLANS[y][i];
      openWeeklyModal(y, row.m, row.s);
    });
  });
}

function openWeeklyModal(year, monthName, strategy) {
  const modal = document.getElementById('modal');
  const content = document.getElementById('modalcontent');
  const title = document.getElementById('modaltitle');
  title.textContent = `${year}년 ${monthName} — ${strategy}`;

  const weeks = weeklyTemplate(strategy);
  const blocks = weeks.map((wk, idx)=>`
    <div class="wk">
      <h4>W${idx+1}. ${wk.title}</h4>
      <ul>${wk.items.map(it=>`<li>${it}</li>`).join("")}</ul>
      ${wk.kpi ? `<div class="kpi">KPI: ${wk.kpi.join(" · ")}</div>` : ""}
    </div>
  `).join("");

  content.innerHTML = blocks;
  modal.classList.add('show');
}

function recalc(year){
  const seed = Number(document.getElementById(`seed-${year}`).value || 0);
  const mode = document.getElementById(`mode-${year}`).value;
  const taxOn = document.getElementById(`tax-${year}`).checked;
  const taxRate = clamp(Number(document.getElementById(`taxrate-${year}`).value || 0), 0, 55);

  const plan = PLANS[year];
  let principalForSimple = seed;
  let balance = seed;
  let totalAdd = 0;
  let totalProfit = 0;

  plan.forEach((_, idx)=>{
    const rEl = document.querySelector(`input.rate-input[data-year="${year}"][data-i="${idx}"]`);
    const aEl = document.querySelector(`input.add-input[data-year="${year}"][data-i="${idx}"]`);
    const rate = Number(rEl.value || 0) / 100;
    const add = Number(aEl.value || 0);

    document.getElementById(`start-${year}-${idx}`).innerText = fmtKRW(balance);

    let base = (mode === "compound") ? (balance + add) : (principalForSimple + add);
    let profit = base * rate;
    if (taxOn && profit > 0) profit = profit * (1 - taxRate/100);

    totalAdd += add;
    totalProfit += profit;

    if (mode === "compound") {
      balance = balance + add + profit;
    } else {
      principalForSimple = principalForSimple + add;
      balance = principalForSimple + totalProfit;
    }

    document.getElementById(`profit-${year}-${idx}`).innerText = fmtKRW(Math.round(profit));
    document.getElementById(`endb-${year}-${idx}`).innerText = fmtKRW(Math.round(balance));
  });

  document.getElementById(`add-${year}`).innerText = fmtKRW(Math.round(totalAdd));
  document.getElementById(`prof-${year}`).innerText = fmtKRW(Math.round(totalProfit));
  document.getElementById(`end-${year}`).innerText = fmtKRW(Math.round(balance));
  document.getElementById(`t-add-${year}`).innerText = fmtKRW(Math.round(totalAdd));
  document.getElementById(`t-prof-${year}`).innerText = fmtKRW(Math.round(totalProfit));
  document.getElementById(`t-end-${year}`).innerText = fmtKRW(Math.round(balance));
}

function wire(year){
  document.getElementById(`recalc-${year}`).addEventListener('click', ()=> recalc(year));
  document.getElementById(`reset-${year}`).addEventListener('click', ()=> {
    PLANS[year].forEach((row, idx)=>{
      document.querySelector(`input.rate-input[data-year="${year}"][data-i="${idx}"]`).value = row.r;
      document.querySelector(`input.add-input[data-year="${year}"][data-i="${idx}"]`).value = 0;
    });
    recalc(year);
  });
  document.getElementById(`clear-${year}`).addEventListener('click', ()=> {
    PLANS[year].forEach((_, idx)=>{
      document.querySelector(`input.add-input[data-year="${year}"][data-i="${idx}"]`).value = 0;
    });
    recalc(year);
  });
  document.getElementById(`seed-${year}`).addEventListener('input', ()=> recalc(year));
  document.getElementById(`mode-${year}`).addEventListener('change', ()=> recalc(year));
  document.getElementById(`tax-${year}`).addEventListener('change', ()=> recalc(year));
  document.getElementById(`taxrate-${year}`).addEventListener('input', ()=> recalc(year));
  document.querySelectorAll(`input.rate-input[data-year="${year}"], input.add-input[data-year="${year}"]`).forEach(el=>{
    el.addEventListener('input', ()=> recalc(year));
  });
}

// 초기화
(function init(){
  const tabs = document.getElementById('tabs');
  const wrap = document.getElementById('tab-wrap');
  ["2026","2027","2028"].forEach((yr, i)=>{
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (i===0?' active':'');
    btn.textContent = yr;
    btn.dataset.year = yr;
    btn.addEventListener('click', (e)=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      e.currentTarget.classList.add('active');
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.getElementById(`tab-${yr}`).classList.add('active');
      recalc(yr);
    });
    tabs.appendChild(btn);

    const tab = createTab(yr);
    wrap.appendChild(tab);
  });

  ["2026","2027","2028"].forEach(yr=>{
    renderRows(yr);
    wire(yr);
  });
  document.getElementById('tab-2026').classList.add('active');
  recalc("2026");

  // 모달 닫기
  document.getElementById('closeModal').addEventListener('click', ()=> document.getElementById('modal').classList.remove('show'));
  
  // 모달 배경 클릭으로 닫기 (모바일에서는 실수 클릭 방지를 위해 제거)
  // document.querySelector('#modal .backdrop').addEventListener('click', ()=> document.getElementById('modal').classList.remove('show'));
})();
</script>

<section class="card">
  <h3>해석 가이드</h3>
  <details>
    <summary>수익률 입력 팁</summary>
    <ul class="muted">
      <li>RWA·국채형 0.4~0.8%/월(연 5~10% 수준), 고위험군(NFT·토큰)은 변동성 큼.</li>
      <li>불확실달에는 0% 또는 음수(손실) 가정으로 스트레스 테스트 권장.</li>
      <li>전략 변경/리밸런싱 달은 낮은 수익률 가정이 합리적.</li>
    </ul>
  </details>
  <details>
    <summary>단리/복리 차이</summary>
    <p class="muted">복리는 매달 이익을 재투자, 단리는 원금 기준 고정. 납입은 해당 월 초에 반영.</p>
  </details>
</section>

<footer>
  © 2025 투자 플랜 시뮬레이터 — 개인 학습/계획용 (모바일 최적화)
</footer>
</body>
</html>
